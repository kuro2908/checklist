<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Lộ trình dự án Web Truyện</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- 
    Chosen Palette: Slate & Sky Blue
    Application Structure Plan: Một trang tổng quan (dashboard) duy nhất hiển thị toàn bộ lộ trình dự án. Cấu trúc này được chọn vì nó trực quan hóa một kế hoạch thành một công cụ theo dõi tiến độ sống động. Người dùng có thể xem tổng quan qua biểu đồ, sau đó đi sâu vào từng giai đoạn. Các thành phần chính bao gồm:
    1. Header: Tiêu đề và thống kê tổng quan.
    2. Biểu đồ tiến độ tổng thể (Donut Chart): Cung cấp cái nhìn nhanh về % hoàn thành của toàn dự án.
    3. Biểu đồ tiến độ theo giai đoạn (Bar Chart): So sánh sự tiến triển giữa các giai đoạn, giúp xác định trọng tâm.
    4. Danh sách công việc tương tác: Mỗi giai đoạn là một module có thể thu gọn/mở rộng, chứa danh sách công việc. Các checkbox có thể được nhấp để cập nhật trạng thái và tự động tính toán lại tất cả các biểu đồ, tạo ra một trải nghiệm tương tác và tức thì.
    Luồng người dùng: Xem tổng quan -> Phân tích từng giai đoạn -> Tương tác với công việc chi tiết.
    Visualization & Content Choices: 
    - Báo cáo (Kế hoạch dự án) -> Mục tiêu (Hiểu tiến độ tổng thể) -> Trình bày (Biểu đồ Donut) -> Tương tác (Cập nhật khi tick vào công việc) -> Lý do (Dễ hiểu, trực quan hóa tỷ lệ phần trăm) -> Thư viện (Chart.js/Canvas).
    - Báo cáo (Các giai đoạn) -> Mục tiêu (So sánh tiến độ các giai đoạn) -> Trình bày (Biểu đồ Cột ngang) -> Tương tác (Cập nhật khi tick vào công việc) -> Lý do (Dễ dàng so sánh độ dài và tiến độ giữa các hạng mục) -> Thư viện (Chart.js/Canvas).
    - Báo cáo (Danh sách công việc) -> Mục tiêu (Tổ chức và tương tác chi tiết) -> Trình bày (Danh sách HTML/CSS có thể thu gọn) -> Tương tác (Checkbox thay đổi trạng thái) -> Lý do (Cung cấp chi tiết, cho phép người dùng thay đổi dữ liệu gốc) -> Phương pháp (HTML/CSS/JS).
    CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 300px;
            width: 100%;
            max-width: 300px;
        }
        .bar-chart-container {
            position: relative;
            margin: auto;
            height: 250px;
            width: 100%;
        }
        .task-checkbox:checked + .task-text {
            text-decoration: line-through;
            color: #64748b; /* slate-500 */
        }
        .phase-header {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .phase-header:hover {
            background-color: #f1f5f9; /* slate-100 */
        }
        .rotate-180 {
            transform: rotate(180deg);
        }
        .transition-transform {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Lộ trình phát triển dự án Web Truyện</h1>
            <p class="text-slate-600 mt-2">Dashboard theo dõi tiến độ và các giai đoạn phát triển của dự án.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <aside class="lg:col-span-1 space-y-8">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold text-center mb-4">Tiến độ tổng thể</h2>
                    <div class="chart-container">
                        <canvas id="overallProgressChart"></canvas>
                    </div>
                    <div class="text-center mt-4 space-y-1">
                        <p class="text-4xl font-bold text-sky-600" id="total-percentage">0%</p>
                        <p class="text-slate-500" id="total-tasks-summary">0/0 công việc hoàn thành</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h2 class="text-xl font-bold text-center mb-4">Tiến độ theo giai đoạn</h2>
                    <div class="bar-chart-container">
                        <canvas id="phaseProgressChart"></canvas>
                    </div>
                </div>
            </aside>

            <section class="lg:col-span-2 space-y-6" id="phases-container">
                <!-- Các giai đoạn sẽ được JS chèn vào đây -->
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const projectData = {
                phases: [
                    {
                        id: 1,
                        title: "Giai đoạn 1: Xây dựng nền tảng Backend",
                        goal: "Tạo ra \"bộ não\" của ứng dụng, định nghĩa cách dữ liệu được lưu trữ và cung cấp các API cơ bản.",
                        tasks: [
                            { text: "Tạo cấu trúc thư mục server và client.", done: true },
                            { text: "Cài đặt Express, Sequelize, mysql2, dotenv, cors.", done: true },
                            { text: "Thiết kế và tạo Database MySQL hoàn chỉnh.", done: true },
                            { text: "Hoàn thành file kết nối server/config/database.js.", done: true },
                            { text: "Tạo các file model của Sequelize.", done: false },
                            { text: "Định nghĩa các mối quan hệ (associations) giữa các model.", done: false },
                            { text: "API đăng ký bằng email & mật khẩu.", done: false },
                            { text: "API đăng nhập bằng email & mật khẩu (JWT).", done: false },
                            { text: "API đăng nhập bằng Google.", done: false },
                            { text: "Middleware bảo vệ route.", done: false },
                            { text: "API lấy danh sách truyện (phân trang).", done: false },
                            { text: "API lấy thông tin chi tiết một truyện.", done: false },
                            { text: "API lấy danh sách chương của một truyện.", done: false },
                            { text: "API lấy nội dung một chương.", done: false },
                            { text: "API tìm kiếm truyện.", done: false }
                        ]
                    },
                    {
                        id: 2,
                        title: "Giai đoạn 2: Xây dựng giao diện người đọc",
                        goal: "Tạo ra các trang chính mà người dùng sẽ thấy và tương tác để đọc truyện.",
                        tasks: [
                            { text: "Cài đặt react-router-dom, axios.", done: false },
                            { text: "Cấu hình proxy trong vite.config.js.", done: false },
                            { text: "Thiết lập cấu trúc thư mục frontend.", done: false },
                            { text: "Xây dựng Trang chủ (Homepage).", done: false },
                            { text: "Xây dựng Trang chi tiết truyện.", done: false },
                            { text: "Xây dựng Trang đọc truyện.", done: false },
                            { text: "Xây dựng Trang kết quả tìm kiếm.", done: false },
                            { text: "Tạo các hàm gọi API trong services.", done: false },
                            { text: "Sử dụng useEffect và useState để fetch dữ liệu.", done: false }
                        ]
                    },
                    {
                        id: 3,
                        title: "Giai đoạn 3: Tích hợp tính năng người dùng & cộng đồng",
                        goal: "Hoàn thiện các tính năng yêu cầu người dùng phải đăng nhập.",
                        tasks: [
                            { text: "Backend: API thêm/xóa truyện khỏi tủ truyện.", done: false },
                            { text: "Backend: API đăng và trả lời bình luận.", done: false },
                            { text: "Backend: API gửi đánh giá/xếp hạng.", done: false },
                            { text: "Backend: API lấy thông tin cá nhân người dùng.", done: false },
                            { text: "Frontend: Component Đăng nhập/Đăng ký.", done: false },
                            { text: "Frontend: Quản lý trạng thái đăng nhập (Context API).", done: false },
                            { text: "Frontend: Chức năng 'Lưu vào tủ truyện'.", done: false },
                            { text: "Frontend: Xây dựng khu vực bình luận.", done: false },
                            { text: "Frontend: Xây dựng trang cá nhân.", done: false }
                        ]
                    },
                    {
                        id: 4,
                        title: "Giai đoạn 4: Hoàn thiện hệ thống quản lý nội dung",
                        goal: "Xây dựng chức năng cốt lõi và đặc biệt nhất của dự án.",
                        tasks: [
                            { text: "Thiết lập Google Service Account.", done: false },
                            { text: "Viết googleService.js ở backend.", done: false },
                            { text: "Backend: API đăng chương mới (tạo Doc).", done: false },
                            { text: "Backend: API lấy nội dung chương để sửa.", done: false },
                            { text: "Backend: API cập nhật chương (ghi đè Doc).", done: false },
                            { text: "Frontend: Tạo trang quản lý/đăng truyện.", done: false },
                            { text: "Frontend: Tích hợp Rich Text Editor.", done: false },
                            { text: "Frontend: Xây dựng form đăng/sửa và kết nối API.", done: false }
                        ]
                    }
                ]
            };

            const phasesContainer = document.getElementById('phases-container');
            let overallProgressChart, phaseProgressChart;

            function calculateProgress() {
                let totalTasks = 0;
                let completedTasks = 0;
                const phaseProgress = projectData.phases.map(phase => {
                    const phaseTotal = phase.tasks.length;
                    const phaseCompleted = phase.tasks.filter(t => t.done).length;
                    totalTasks += phaseTotal;
                    completedTasks += phaseCompleted;
                    return {
                        name: `GĐ ${phase.id}`,
                        completed: phaseCompleted,
                        total: phaseTotal,
                        percentage: phaseTotal > 0 ? (phaseCompleted / phaseTotal) * 100 : 0
                    };
                });
                const overallPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
                return {
                    totalTasks,
                    completedTasks,
                    overallPercentage,
                    phaseProgress
                };
            }
            
            function renderPhases() {
                phasesContainer.innerHTML = '';
                projectData.phases.forEach((phase, index) => {
                    const phaseElement = document.createElement('div');
                    phaseElement.className = 'bg-white rounded-xl shadow-md overflow-hidden';
                    
                    const completedTasks = phase.tasks.filter(t => t.done).length;
                    const totalTasks = phase.tasks.length;
                    const percentage = totalTasks > 0 ? Math.round((completedTasks/totalTasks) * 100) : 0;

                    phaseElement.innerHTML = `
                        <div class="phase-header p-4 border-b border-slate-200 flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-bold text-slate-900">${phase.title}</h3>
                                <p class="text-sm text-slate-500">${phase.goal}</p>
                            </div>
                            <div class="flex items-center space-x-4">
                               <span class="text-sm font-semibold text-sky-600">${completedTasks}/${totalTasks}</span>
                               <svg class="w-6 h-6 text-slate-400 transition-transform chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                               </svg>
                            </div>
                        </div>
                        <div class="task-list hidden p-4 space-y-3">
                            ${phase.tasks.map((task, taskIndex) => `
                                <label class="flex items-center space-x-3 cursor-pointer">
                                    <input type="checkbox" data-phase-index="${index}" data-task-index="${taskIndex}" 
                                           class="task-checkbox h-5 w-5 rounded border-gray-300 text-sky-600 focus:ring-sky-500" 
                                           ${task.done ? 'checked' : ''}>
                                    <span class="task-text text-slate-700">${task.text}</span>
                                </label>
                            `).join('')}
                        </div>
                    `;
                    phasesContainer.appendChild(phaseElement);
                });
                
                // Add event listeners for collapsibles
                document.querySelectorAll('.phase-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const taskList = header.nextElementSibling;
                        const chevron = header.querySelector('.chevron');
                        taskList.classList.toggle('hidden');
                        chevron.classList.toggle('rotate-180');
                    });
                });

                // Add event listeners for checkboxes
                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const phaseIndex = e.target.dataset.phaseIndex;
                        const taskIndex = e.target.dataset.taskIndex;
                        projectData.phases[phaseIndex].tasks[taskIndex].done = e.target.checked;
                        updateDashboard();
                    });
                });
            }

            function updateDashboard() {
                const progress = calculateProgress();

                // Update text summary
                document.getElementById('total-percentage').textContent = `${Math.round(progress.overallPercentage)}%`;
                document.getElementById('total-tasks-summary').textContent = `${progress.completedTasks}/${progress.totalTasks} công việc hoàn thành`;

                // Update Overall Chart
                if (overallProgressChart) {
                    overallProgressChart.data.datasets[0].data = [progress.completedTasks, progress.totalTasks - progress.completedTasks];
                    overallProgressChart.update();
                }

                // Update Phase Chart
                if (phaseProgressChart) {
                    phaseProgressChart.data.labels = progress.phaseProgress.map(p => p.name);
                    phaseProgressChart.data.datasets[0].data = progress.phaseProgress.map(p => p.percentage);
                    phaseProgressChart.update();
                }
                
                // Re-render phase progress text (could be more efficient, but fine for this scale)
                document.querySelectorAll('.phase-header').forEach((header, index) => {
                    const phase = projectData.phases[index];
                    const completedTasks = phase.tasks.filter(t => t.done).length;
                    const totalTasks = phase.tasks.length;
                    header.querySelector('.font-semibold').textContent = `${completedTasks}/${totalTasks}`;
                });
            }

            function createCharts() {
                const progress = calculateProgress();
                
                // Overall Progress Chart (Donut)
                const overallCtx = document.getElementById('overallProgressChart').getContext('2d');
                overallProgressChart = new Chart(overallCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Hoàn thành', 'Chưa làm'],
                        datasets: [{
                            data: [progress.completedTasks, progress.totalTasks - progress.completedTasks],
                            backgroundColor: ['#0284c7', '#e0f2fe'], // sky-600, sky-100
                            borderColor: '#ffffff',
                            borderWidth: 4,
                            hoverOffset: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                enabled: true
                            }
                        }
                    }
                });

                // Phase Progress Chart (Horizontal Bar)
                const phaseCtx = document.getElementById('phaseProgressChart').getContext('2d');
                phaseProgressChart = new Chart(phaseCtx, {
                    type: 'bar',
                    data: {
                        labels: progress.phaseProgress.map(p => p.name),
                        datasets: [{
                            label: '% Hoàn thành',
                            data: progress.phaseProgress.map(p => p.percentage),
                            backgroundColor: '#38bdf8', // sky-400
                            borderColor: '#0284c7', // sky-600
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    display: true,
                                    color: '#e2e8f0' // slate-200
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + "%"
                                    }
                                }
                            },
                            y: {
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return ` ${context.dataset.label}: ${Math.round(context.raw)}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Initial render
            renderPhases();
            createCharts();
            updateDashboard();
        });
    </script>
</body>
</html>
